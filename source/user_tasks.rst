.. sectionauthor:: Артём Светлов <artem.svetlov@nextgis.ru>

.. _user_tasks:

Пользовательские задачи
================================

Создание слоя
--------------------------

Одним из основных компонентов ПО NextGIS Web является слой. Слой это растровое изображение и векторный файл (таблица БД). Для объединения слоев в виде карты необходимо настроить стиль (или набор стилей) отображения слоя.

Стили могут настраиваться только для векторных слоев.

Интерфейс добавления PostGIS, векторных и растровых слоев приблизительно одинаковый. Нужно ввести параметры слоя, затем добавить стиль.

Растровый слой
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Для добавления растрового слоя перейдите в группу, где необходимо его создать. В блоке операций выберите :menuselection:`Добавить --> Растровый слой`. Откроется окно представленное на :numref:`admin_layers_create_raster_layer_resourse_description`. 

.. figure:: _static/admin_layers_create_raster_layer_resourse_description.png
   :name: admin_layers_create_raster_layer_resourse_description
   :align: center


Введите наименование слоя, которое будет отображаться в в административном веб интерфейсе, а также в дереве слоев карт.
Поля «Ключ» и «Описание» являются необязательными параметрами.

Переключитесь со вкладки «Ресурс» на вкладку «Растровый слой». Откроется окно представленное на :numref:`admin_layers_create_raster_layer_upload`.

.. figure:: _static/admin_layers_create_raster_layer_upload.png
   :name: admin_layers_create_raster_layer_upload
   :align: center

Далее необходимо выбрать систему координат в которую будет перепроецирован растр (по-умолчанию имеется только WGS84 / Pseudo Mercator (EPSG:3857) ).
Далее необходимо указать сам файл. 

.. note:: Файл может быть только формата GeoTIFF с 3 или 4 каналами (RGB или RGBA). 
 
Большинство утилит не создают альфа канал, а только добавляют значение NoData. Для преобразования значений NoData в альфа канал можно воспользоваться утилитой командной строки gdalwarp. Ниже приведен пример команды.

.. code:: shell

    gdalwarp -t_srs EPSG:3857 -multi -dstalpha -dstnodata none -wo "UNIFIED_SRC_NODATA=YES" -co COMPRESS=JPEG d:\temp\o\ast_20010730_010043_rgb.tif d:\temp\o\ast_20010730_010043_rgba.tif


После удачной загрузки растра необходимо создать стиль (если он не был создан автоматически). 
При создании карты (подробнее см. подразд. 4.4) можно добавлять растр на карту, выбрав растр и его стиль.

.. note:: В NextGIS Manager эту операцию можно сделать проще. В програме есть функционал загрузки растра в NextGIS Web и обрезки по альфа-каналу. 















Векторный слой
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Введите наименование слоя, которое будет отображаться в в административном веб интерфейсе, а также в дереве слоев карты. 

Поля «Ключ» и «Описание» являются необязательными параметрами. 

Переключитесь со вкладки «Ресурс» на вкладку «Векторный слой». Откроется окно представленное на :numref:`admin_layers_create_vector_layer_resourse_description`. 

.. figure:: _static/admin_layers_create_vector_layer_resourse_description.png
   :name: admin_layers_create_vector_layer_resourse_description
   :align: center

Далее необходимо выбрать систему координат в которую будет перепроецированы векторные данные (по-умолчанию имеется только WGS84 / Pseudo Mercator (EPSG:3857) ). 

Далее необходимо указать сам файл. 

.. note:: Файл может быть только формата ESRI Shapefie. При этом все составляющие его части (dbf, shp, shx, prj и др.) должны быть упакованы в архив формата zip. 


.. figure:: _static/admin_layers_create_vector_layer_upload.png
   :name: admin_layers_create_vector_layer_upload
   :align: center

Кроме того, необходимо указать кодировку в которой записаны атрибуты. Если кодировка не указана, то данные должен сопровождать файл с описание кодировки (расширение cpg). 

После удачной загрузки векторного файла необходимо создать стиль. Подробнее о создании стилей описано в подразд. 4.3

При создании карты (подробнее см. подразд. 4.4) можно добавлять векторный слой на карту указывая его стиль.
